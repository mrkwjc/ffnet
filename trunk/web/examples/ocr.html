<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>ocr.py</title>
</head>
<body>
<pre style='color:#181615;background-color:#ffffff;'>
<i><span style='color:#898887;'>#####################################################################</span></i><b><span style='color:#bf0303;background:#f7e6e6;'>###</span></b>
<i><span style='color:#898887;'>##  Copyright (C) 2006 by Marek Wojciechowski</span></i>
<i><span style='color:#898887;'>##  &lt;mwojc@p.lodz.pl&gt;</span></i>
<i><span style='color:#898887;'>##</span></i>
<i><span style='color:#898887;'>##  Distributed under the terms of the GNU General Public License (GPL)</span></i>
<i><span style='color:#898887;'>##  http://www.gnu.org/copyleft/gpl.html</span></i>
<i><span style='color:#898887;'>#####################################################################</span></i><b><span style='color:#bf0303;background:#f7e6e6;'>###</span></b>

<i><span style='color:#898887;'>### Digits recognition example for ffnet </span></i><b><span style='color:#bf0303;background:#f7e6e6;'>###</span></b>

<i><span style='color:#898887;'># Training file (data/ocr.dat) contains 68 patterns - first 58 </span></i>
<i><span style='color:#898887;'># are used for training and last 10 are used for testing. </span></i>
<i><span style='color:#898887;'># Each pattern contains 64 inputs which define 8x8 bitmap of </span></i>
<i><span style='color:#898887;'># the digit and last 10 numbers are the targets (10 targets for 10 digits).</span></i>
<i><span style='color:#898887;'># Layered network architecture is used here: (64, 10, 10, 10).</span></i>

<span style='color:#ff80e0;'>from</span> ffnet <span style='color:#ff80e0;'>import</span> ffnet, mlgraph, readdata

<i><span style='color:#898887;'># Generate standard layered network architecture and create network</span></i>
conec <b>=</b> mlgraph((<span style='color:#b08000;'>64</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>10</span>))
net <b>=</b> ffnet(conec)

<i><span style='color:#898887;'># Read data file</span></i>
<b>print</b> <span style='color:#bf0303;'>&quot;READING DATA...&quot;</span>
data <b>=</b> readdata( <span style='color:#bf0303;'>'data/ocr.dat'</span>, delimiter <b>=</b> <span style='color:#bf0303;'>' '</span> )
<span style='color:#0057ae;'>input</span> <b>=</b>  data[:, :<span style='color:#b08000;'>64</span>] <i><span style='color:#898887;'>#first 64 columns - bitmap definition</span></i>
target <b>=</b> data[:, <span style='color:#b08000;'>64</span>:] <i><span style='color:#898887;'>#the rest - 10 columns for 10 digits</span></i>

<i><span style='color:#898887;'># Train network with scipy tnc optimizer - 58 lines used for training</span></i>
<b>print</b> <span style='color:#bf0303;'>&quot;TRAINING NETWORK...&quot;</span>
net.train_tnc(<span style='color:#0057ae;'>input</span>[:<span style='color:#b08000;'>58</span>], target[:<span style='color:#b08000;'>58</span>], maxfun <b>=</b> <span style='color:#b08000;'>2000</span>, messages<b>=</b><span style='color:#b08000;'>1</span>)

<i><span style='color:#898887;'># Test network - remaining 10 lines used for testing</span></i>
<b>print</b>
<b>print</b> <span style='color:#bf0303;'>&quot;TESTING NETWORK...&quot;</span>
output, regression <b>=</b> net.test(<span style='color:#0057ae;'>input</span>[<span style='color:#b08000;'>58</span>:], target[<span style='color:#b08000;'>58</span>:], iprint <b>=</b> <span style='color:#b08000;'>2</span>)

<i><span style='color:#898887;'>#########################################################</span></i><b><span style='color:#bf0303;background:#f7e6e6;'>###</span></b>
<i><span style='color:#898887;'># Make a plot of a chosen digit along with the network guess</span></i>
<b>try</b>:
    <span style='color:#ff80e0;'>from</span> pylab <span style='color:#ff80e0;'>import</span> <b>*</b>
    <span style='color:#ff80e0;'>from</span> random <span style='color:#ff80e0;'>import</span> randint
    
    digitpat <b>=</b> randint(<span style='color:#b08000;'>58</span>, <span style='color:#b08000;'>67</span>) <i><span style='color:#898887;'>#Choose testing pattern to plot</span></i>
    
    subplot(<span style='color:#b08000;'>211</span>)
    imshow(<span style='color:#0057ae;'>input</span>[digitpat].reshape(<span style='color:#b08000;'>8</span>,<span style='color:#b08000;'>8</span>), interpolation <b>=</b> <span style='color:#bf0303;'>'nearest'</span>)
    
    subplot(<span style='color:#b08000;'>212</span>)
    N <b>=</b> <span style='color:#b08000;'>10</span>  <i><span style='color:#898887;'># number of digits / network outputs</span></i>
    ind <b>=</b> arange(N)   <i><span style='color:#898887;'># the x locations for the groups</span></i>
    width <b>=</b> <span style='color:#b08000;'>0.35</span>       <i><span style='color:#898887;'># the width of the bars</span></i>
    bar(ind, net(<span style='color:#0057ae;'>input</span>[digitpat]), width, color<b>=</b><span style='color:#bf0303;'>'b'</span>) <i><span style='color:#898887;'>#make a plot</span></i>
    xticks(ind<b>+</b>width<b>/</b><span style='color:#b08000;'>2.</span>, (<span style='color:#bf0303;'>'1'</span>, <span style='color:#bf0303;'>'2'</span>, <span style='color:#bf0303;'>'3'</span>, <span style='color:#bf0303;'>'4'</span>, <span style='color:#bf0303;'>'5'</span>, <span style='color:#bf0303;'>'6'</span>, <span style='color:#bf0303;'>'7'</span>, <span style='color:#bf0303;'>'8'</span>, <span style='color:#bf0303;'>'9'</span>, <span style='color:#bf0303;'>'0'</span>))
    xlim(<b>-</b>width,N<b>-</b>width)
    axhline(linewidth<b>=</b><span style='color:#b08000;'>1</span>, color<b>=</b><span style='color:#bf0303;'>'black'</span>)
    title(<span style='color:#bf0303;'>&quot;Trained network (64-10-10-10) guesses a digit above...&quot;</span>)
    xlabel(<span style='color:#bf0303;'>&quot;Digit&quot;</span>)
    ylabel(<span style='color:#bf0303;'>&quot;Network outputs&quot;</span>)
   
    show()
<b>except</b> <b><span style='color:#054d00;'>ImportError</span></b>, e: 
    <b>print</b> <span style='color:#bf0303;'>&quot;Cannot make plots. For plotting install matplotlib.</span><span style='color:#ff80e0;'>\n</span><span style='color:#0057ae;'>%s</span><span style='color:#bf0303;'>&quot;</span> <b>%</b> e
    
<b>print</b> <b>\</b>
<i><span style='color:#898887;'>&quot;&quot;&quot;</span></i>
<i><span style='color:#898887;'>Note:</span></i>
<i><span style='color:#898887;'>Normalization of input/output data is handled automatically in ffnet.</span></i>
<i><span style='color:#898887;'>Just use your raw data both at trainig and recalling phase. </span></i>
<i><span style='color:#898887;'>&quot;&quot;&quot;</span></i>
</pre>
</body>
</html>
