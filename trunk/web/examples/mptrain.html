<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>mptrain.py</title>
</head>
<body>
<pre style='color:#181615;background-color:#ffffff;'>
<i><span style='color:#898887;'># -*- coding: utf-8 -*-</span></i>
<i><span style='color:#898887;'>#####################################################################</span></i><b><span style='color:#bf0303;background:#f7e6e6;'>###</span></b>
<i><span style='color:#898887;'>##  Copyright (C) 2011 by Marek Wojciechowski</span></i>
<i><span style='color:#898887;'>##  &lt;mwojc@p.lodz.pl&gt;</span></i>
<i><span style='color:#898887;'>##</span></i>
<i><span style='color:#898887;'>##  Distributed under the terms of the GNU General Public License (GPL)</span></i>
<i><span style='color:#898887;'>##  http://www.gnu.org/copyleft/gpl.html</span></i>
<i><span style='color:#898887;'>#####################################################################</span></i><b><span style='color:#bf0303;background:#f7e6e6;'>###</span></b>
<span style='color:#ff80e0;'>from</span> ffnet <span style='color:#ff80e0;'>import</span> ffnet, mlgraph
<span style='color:#ff80e0;'>from</span> scipy <span style='color:#ff80e0;'>import</span> rand

<i><span style='color:#898887;'># Generate random training data (large)</span></i>
<span style='color:#0057ae;'>input</span> <b>=</b> rand(<span style='color:#b08000;'>10000</span>, <span style='color:#b08000;'>10</span>)
target <b>=</b> rand(<span style='color:#b08000;'>10000</span>, <span style='color:#b08000;'>1</span>)

<i><span style='color:#898887;'># Define net (large one)</span></i>
conec <b>=</b> mlgraph((<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>300</span>,<span style='color:#b08000;'>1</span>))
net <b>=</b> ffnet(conec)

<i><span style='color:#898887;'># Test training speed-up</span></i>
<i><span style='color:#898887;'># Note that the below *if* is necessary only on Windows</span></i>
<b>if</b> <span style='color:#0057ae;'>__name__</span><b>==</b><span style='color:#bf0303;'>'__main__'</span>:    
    stored_weights <b>=</b> net.weights.copy()
    
    <b>print</b> <span style='color:#bf0303;'>&quot;Training in single process:&quot;</span>
    <span style='color:#ff80e0;'>from</span> time <span style='color:#ff80e0;'>import</span> time
    t0 <b>=</b> time()
    net.train_tnc(<span style='color:#0057ae;'>input</span>, target, nproc <b>=</b> <span style='color:#b08000;'>1</span>, maxfun<b>=</b><span style='color:#b08000;'>50</span>, messages<b>=</b><span style='color:#b08000;'>1</span>) 
    t1 <b>=</b> time()
    single_time <b>=</b> t1<b>-</b>t0

    <b>print</b>

    <span style='color:#ff80e0;'>from</span> multiprocessing <span style='color:#ff80e0;'>import</span> cpu_count
    <b>print</b> <span style='color:#bf0303;'>&quot;Trainig in </span><span style='color:#0057ae;'>%s</span><span style='color:#bf0303;'> processes:&quot;</span> <b>%</b>cpu_count()
    net.weights <b>=</b> stored_weights <i><span style='color:#898887;'># Just to start from the same point</span></i>
    t0 <b>=</b> time()
    net.train_tnc(<span style='color:#0057ae;'>input</span>, target, nproc <b>=</b> <span style='color:#bf0303;'>'ncpu'</span>, maxfun<b>=</b><span style='color:#b08000;'>50</span>, messages<b>=</b><span style='color:#b08000;'>1</span>) <i><span style='color:#898887;'># THAT'S IT!</span></i>
    t1 <b>=</b> time()
    allproc_time <b>=</b> t1<b>-</b>t0

    <b>print</b>
    <b>print</b> <span style='color:#bf0303;'>'Train time, single process:'</span>, single_time
    <b>print</b> <span style='color:#bf0303;'>'Train time, </span><span style='color:#0057ae;'>%s</span><span style='color:#bf0303;'> processes:'</span> <b>%</b>cpu_count(), allproc_time

</pre>
</body>
</html>
